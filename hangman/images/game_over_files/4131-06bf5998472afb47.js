"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4131],{89705:function(e,n,t){t.d(n,{EM:function(){return l},b8:function(){return s}});var i=t(5362),u=t(27218),r=t(27895),a=t(13262),o=t(10228),c=t(77930);let l=()=>{let{account:e,activeOrganization:n}=(0,u.t)(),t=null==e?void 0:e.uuid,l=null==n?void 0:n.uuid,{addError:s}=(0,r.e)(),d=(0,c.useQueryClient)();return(0,i.uC)("/api/organizations/".concat(l,"/sync/mcp/drive/ingest"),"POST",{onSuccess:()=>{setTimeout(()=>{d.invalidateQueries({queryKey:[a.dY,{orgUuid:l,accountUuid:t,syncSourceType:o.Fg.GDRIVE}]})},300)},onError:e=>{s(e)}})},s=()=>{let{activeOrganization:e}=(0,u.t)(),n=null==e?void 0:e.uuid,{addError:t}=(0,r.e)(),l=(0,c.useQueryClient)();return(0,i.uC)("/api/organizations/".concat(n,"/sync/ingestion/gdrive/clean_up"),"POST",{onSuccess:()=>{l.invalidateQueries({queryKey:[a.dY,{orgUuid:n,syncSourceType:o.Fg.GDRIVE}]})},onError:e=>{t(e)}})}},2949:function(e,n,t){t.d(n,{$Z:function(){return L},Aj:function(){return b},EU:function(){return U},En:function(){return C},MN:function(){return h},Mv:function(){return w},Rs:function(){return T},Xv:function(){return D},ez:function(){return P},f0:function(){return Q},mD:function(){return I},nC:function(){return A},oE:function(){return E},qZ:function(){return G},r7:function(){return q},td:function(){return F}});var i=t(19170),u=t(5362),r=t(27218),a=t(13262),o=t(87033),c=t(10228),l=t(88755),s=t(77930),d=t(81695),f=t(7653),g=t(89705),v=t(21878),y=t(51879),p=t(22534),_=t(19132);let m="gdrive_success",h=()=>{let e=(0,r.Cf)(),{data:n}=(0,_.tc)(),t=!!(Array.isArray(n)&&n.find(e=>e.type===c.Fg.GDRIVE&&e.enabled));return!e||t},b=()=>{let e=h(),{value:n}=(0,o.FL)("kingfisher_enabled"),t=(0,r.rW)();return!!(n&&e&&t)},E=()=>{let{account:e,activeOrganization:n}=(0,r.t)(),t=null==n?void 0:n.uuid,i=b(),{data:o,isFetched:c}=(0,u.WE)("/api/organizations/".concat(t,"/sync/mcp/drive/auth"),{queryKey:[a.Yw,{accountUUID:null==e?void 0:e.uuid,orgUUID:t}],enabled:i,staleTime:3e5});return{isAuthenticated:i&&!!(null==o?void 0:o.is_authenticated),isFetched:c}},S=e=>{let{callerIdentifier:n}=e,t=(0,d.usePathname)(),{account:i,activeOrganization:o}=(0,r.t)(),c=null==i?void 0:i.uuid,g=null==o?void 0:o.uuid,v=b(),y=(0,d.useRouter)(),p=(0,s.useQueryClient)(),h=(0,l.Q)(),E=(0,d.useSearchParams)(),{mutate:S}=(0,u.uC)("/api/organizations/".concat(g,"/sync/mcp/drive/auth/start"),"POST",{enabled:v,onSuccess:e=>{y.push(e.redirect_url)}}),A=(0,f.useRef)(!1);return()=>{if(!v)return;let e="".concat(m,"=").concat(n),i=(0,_.LZ)({pathname:t,searchParams:E,queryString:e,isClaudeApp:h});if(p.invalidateQueries({queryKey:[a.Yw,{accountUUID:c,orgUUID:g}]}),h){window.open("/settings/profile?open_in_browser=1&auth_start=gdrive&origin=".concat(i));return}A.current||(A.current=!0,S({pre_auth_state:{origin:i},redirect_uri:new URL("/connect/mcp/drive/callback",window.location.origin).toString()}))}},A=function(){let{callerIdentifier:e,handleAuthSuccess:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{isAuthenticated:t,isFetched:i}=E(),u=Q(),{dropdownToOpen:r,openModal:a,clearCallerIdentifier:o}=(0,y.J)(),c=function(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!t){null==n||n(t);return}u?(a(e),null==n||n(!1)):null==n||n(t)},l=S({callerIdentifier:e});return(0,_.BZ)({callerIdentifier:e,successParam:m,handleOpen:c}),(0,f.useEffect)(()=>{e&&r===e&&(null==n||n(!0),o())},[r,n,e,o]),{isDriveAuthenticated:t,shouldShowDriveIndexingEnablementModal:u,initDriveAuth:l,handleDriveTrigger:c,isFetched:i}},C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:n,activeOrganization:t}=(0,r.t)(),i=null==n?void 0:n.uuid,o=null==t?void 0:t.uuid,c=b(),l=(0,s.useQueryClient)(),{mutate:d}=(0,g.b8)();return(0,u.uC)("/api/organizations/".concat(o,"/sync/mcp/drive/auth"),"DELETE",{enabled:!!(t&&c),...e,onSuccess:function(){for(var n,t=arguments.length,u=Array(t),r=0;r<t;r++)u[r]=arguments[r];l.invalidateQueries({queryKey:[a.Yw,{accountUUID:i,orgUUID:o}]}),d({}),null===(n=e.onSuccess)||void 0===n||n.call(e,...u)}})},w=e=>{let{documentId:n}=e,{account:t,activeOrganization:i}=(0,r.t)(),o=null==t?void 0:t.uuid,c=null==i?void 0:i.uuid,l=b(),d=(0,s.useQueryClient)(),g=(0,u.WE)("/api/organizations/".concat(c,"/sync/mcp/drive/document/").concat(n),{queryKey:[a.HI,{accountUUID:o,orgUUID:c,documentId:n}],enabled:l,meta:{noToast:!0}}),v=g.isError;return(0,f.useEffect)(()=>{v&&d.invalidateQueries({queryKey:[a.Yw,{accountUUID:o,orgUUID:c}]})},[d,v,o,c]),g};function D(e){let{uri:n}=e,{data:t,isLoading:i}=w({documentId:n});return{title:null==t?void 0:t.title,isLoading:i}}let I=e=>{let{account:n,activeOrganization:t}=(0,r.t)(),i=null==n?void 0:n.uuid,o=null==t?void 0:t.uuid,c=b(),l=(0,f.useMemo)(()=>e.map(e=>"/api/organizations/".concat(o,"/sync/mcp/drive/document/").concat(e)),[e,o]),s=(0,f.useMemo)(()=>({queryKey:e.map(e=>[a.Yp,{accountUUID:i,orgUUID:o,documentId:e}]),enabled:c,meta:{noToast:!0}}),[e,i,o,c]);return(0,u.Nl)(l,s)},F=e=>{let{account:n,activeOrganization:t}=(0,r.t)(),i=null==n?void 0:n.uuid,o=null==t?void 0:t.uuid,c=b(),l=(0,p.F7)(),{data:s,isSuccess:d,isLoading:g}=(0,u.WE)("/api/organizations/".concat(o,"/sync/mcp/drive/recents"),{queryKey:[a.s8,{accountUUID:i,orgUUID:o}],enabled:e&&c,meta:{noToast:!0}});return(0,f.useEffect)(()=>{if(d&&s){let e=s.map(e=>{let{uri:n,title:t}=e;return{uri:n,title:t}});(0,p.MU)(e)}},[d,s]),{recentDriveDocs:d?s:l,isLoading:g}},T="drive_indexing_enablement_2/11_1",L=()=>{let{value:e}=(0,o.FL)("apps_use_bananagrams");return e},P=()=>{let e=b(),n=(0,r.rW)(),{value:t}=(0,o.FL)("apps_use_bananagrams");return e&&n&&t},U=e=>{var n;let t=P(),{account:i}=(0,r.t)();return!!t&&(e?!!(null==e?void 0:null===(n=e.conversationSettings)||void 0===n?void 0:n.enabled_bananagrams):!!(null==i?void 0:i.settings.enabled_bananagrams))},q=()=>{let e=P(),n=(0,r.Cf)(),t=(0,r.gQ)(),{data:i}=(0,_.tc)(),{account:u}=(0,r.t)();return!!e&&!!t&&(n?!!(Array.isArray(i)&&i.find(e=>{var n;return e.type===c.Fg.GDRIVE&&e.enabled&&(null===(n=e.config)||void 0===n?void 0:n.allow_indexing)})):!!(null==u?void 0:u.settings.enabled_gdrive_indexing))},Q=()=>{let{isDismissed:e}=(0,v.K)(),n=e(T),t=(0,r.Cf)(),i=P(),{isAuthenticated:u}=E();return!t&&i&&!n&&u},G=()=>{let{account:e}=(0,r.t)(),{mutate:n}=(0,i.Ck)(),{mutate:t}=(0,g.EM)();return{toggleDriveSearchAndIndexingEnabled:i=>{var u;let{indexingEnabled:r,searchEnabled:a,dismissBanner:o}=i,c=o||!!r;r&&t({}),n({...null==e?void 0:e.settings,...void 0!==r?{enabled_gdrive_indexing:r}:null,...void 0!==a||!0===r?{enabled_bananagrams:null!=r?r:a}:null,...c?{dismissed_claudeai_banners:[...(null==e?void 0:null===(u=e.settings)||void 0===u?void 0:u.dismissed_claudeai_banners)||[],{banner_id:T,dismissed_at:new Date().toISOString()}]}:null})}}}},74339:function(e,n,t){t.d(n,{J$:function(){return d},RS:function(){return s},Zf:function(){return l},fX:function(){return g},gQ:function(){return c},vc:function(){return f}});var i=t(5362),u=t(27218),r=t(13262);t(10228);var a=t(7653),o=t(19132);let c=e=>{let{documentId:n}=e,{account:t,activeOrganization:a}=(0,u.t)(),o=null==t?void 0:t.uuid,c=null==a?void 0:a.uuid,l=d();return(0,i.WE)("/api/organizations/".concat(c,"/sync/mcp/outline/document/").concat(n),{queryKey:[r.q2,{accountUUID:o,orgUUID:c,documentId:n}],enabled:l})},l=e=>{let{uri:n}=e,{data:t,isLoading:i}=c({documentId:n});return{title:null==t?void 0:t.title,isLoading:i}},s=e=>{let{account:n,activeOrganization:t}=(0,u.t)(),o=null==n?void 0:n.uuid,c=null==t?void 0:t.uuid,l=d(),s=(0,a.useMemo)(()=>e.map(e=>"/api/organizations/".concat(c,"/sync/mcp/outline/document/").concat(e)),[e,c]),f=(0,a.useMemo)(()=>({queryKey:e.map(e=>[r.q2,{accountUUID:o,orgUUID:c,documentId:e}]),enabled:l,meta:{noToast:!0}}),[o,e,l,c]);return(0,i.Nl)(s,f)},d=()=>{let{data:e}=(0,o.tc)();return!1},f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:n,activeOrganization:t}=(0,u.t)(),a=null==t?void 0:t.uuid,o=d(),{data:c,refetch:l}=(0,i.WE)("/api/organizations/".concat(a,"/sync/mcp/outline/auth"),{queryKey:[r.Sp,{accountUUID:null==n?void 0:n.uuid,orgUUID:a}],enabled:!!(t&&o),staleTime:5e3}),{mutate:s,isPending:f}=(0,i.uC)("/api/organizations/".concat(a,"/sync/mcp/outline/auth/start"),"POST",{enabled:!!(t&&o),...e,onSuccess:function(){for(var n,t=arguments.length,i=Array(t),u=0;u<t;u++)i[u]=arguments[u];null===(n=e.onSuccess)||void 0===n||n.call(e,...i)}});return{isOutlineAuthenticated:!!(null==c?void 0:c.is_authenticated),refetch:l,initOutlineAuth:s,isLoadingOutlineAuthInit:f}},g=()=>{let e=encodeURIComponent(window.location.href);window.location.href="/settings/profile?redirect_url=".concat(e,"&open_outline_auth=true")}},19132:function(e,n,t){t.d(n,{BZ:function(){return b},Bl:function(){return Q},LZ:function(){return E},M1:function(){return _},QD:function(){return U},gb:function(){return D},hJ:function(){return y},j5:function(){return q},sf:function(){return A},tc:function(){return p},te:function(){return L},xm:function(){return C},xn:function(){return m}});var i=t(19170),u=t(5362),r=t(27218),a=t(27895),o=t(30947),c=t(13262),l=t(87033),s=t(10228),d=t(88755),f=t(77930),g=t(81695),v=t(7653);let y=e=>e.type===s.Fg.GITHUB?{sync_source_type:s.Fg.GITHUB,sync_source_config:e.config}:e.type===s.Fg.GDRIVE?{sync_source_type:s.Fg.GDRIVE,sync_source_config:e.config}:null,p=()=>{let{activeOrganization:e}=(0,r.t)(),n=null==e?void 0:e.uuid;return(0,u.WE)("/api/organizations/".concat(n,"/sync/settings"),{queryKey:[c.FU,{orgUUID:n}],enabled:!!e})},_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,r.t)(),t=null==n?void 0:n.uuid,i=(0,f.useQueryClient)();return(0,u.Ne)("/api/organizations/".concat(t,"/sync/settings"),"PUT",(e,n)=>{let{type:t,enabled:i}=e;n||(n=[]);let u=n.map(e=>e.type===t?{...e,enabled:i}:e);return u.some(e=>e.type===t)?u:[...n,{type:t,enabled:i}]},{queryKey:[c.FU,{orgUUID:t}],enabled:!!n,onSuccess:async function(){for(var n,u=arguments.length,r=Array(u),a=0;a<u;a++)r[a]=arguments[a];await i.invalidateQueries({queryKey:[c.FU,{orgUUID:t}]}),await (null===(n=e.onSuccess)||void 0===n?void 0:n.call(e,...r))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,r.t)(),t=null==n?void 0:n.uuid,i=(0,f.useQueryClient)(),{value:a}=(0,l.FL)("kingfisher_enabled"),{value:o}=(0,l.FL)("apps_use_bananagrams");return(0,u.Ne)("/api/organizations/".concat(t,"/sync/settings/config"),"POST",(e,n)=>{let{type:t,config:i}=e;return n||(n=[]),n.map(e=>e.type===t?{...e,config:{...e.config,...i}}:e)},{queryKey:[c.FU,{orgUUID:t}],enabled:!!(n&&a&&o),onSuccess:async function(){for(var n,u=arguments.length,r=Array(u),a=0;a<u;a++)r[a]=arguments[a];await i.invalidateQueries({queryKey:[c.FU,{orgUUID:t}]}),await (null===(n=e.onSuccess)||void 0===n?void 0:n.call(e,...r))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},h=(e,n)=>{let t=new URLSearchParams(Array.from(n.entries()));t.delete(e);let i=t.toString()?"?".concat(t.toString()):"",u=window.location.pathname+i;window.history.replaceState({...window.history.state,as:u,url:u},"",u)},b=e=>{let{callerIdentifier:n,successParam:t,handleOpen:i}=e,u=(0,g.useSearchParams)(),r=(0,v.useRef)(!1);(0,v.useEffect)(()=>{!u.has(t)||r.current||n&&n!==u.get(t)||(r.current=!0,h(t,u),i())},[u,n,i,t])},E=e=>{let{pathname:n,searchParams:t,queryString:i,isClaudeApp:u}=e,r="".concat(n,"?").concat(i),a=t.get("origin");if(a)r=a;else if(u){let e=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i,t=n.startsWith("/project/")&&e.test(n.slice(9)),u=n.startsWith("/chat/")&&e.test(n.slice(6));r="claude://claude.ai".concat(t||u||"/new"===n?n:"/new","?").concat(i)}return r},S=e=>[s.co.CREATED,s.co.PENDING,s.co.UPDATING].includes(e),A=e=>S(e.status.state),C=e=>[s.co.FAILED,s.co.UPDATE_FAILED].includes(e.status.state),w=e=>{if(e instanceof o.Hx)return e instanceof o.Hx&&"access_denied"===e.errorCode},D=()=>{let{addError:e}=(0,a.e)(),n=(0,f.useQueryClient)();return(t,i)=>{w(t)&&(e("Please try again. You may need to reconnect with your ".concat(s.hP[i.sync_source_type]," account.")),c.Su.forEach(e=>{n.invalidateQueries({queryKey:[e]})}),n.invalidateQueries({queryKey:[c.cF]}))}},I={[s.Fg.GCAL]:"enabled_foccacia",[s.Fg.GMAIL]:"enabled_sourdough"},F=e=>{let n=e===s.Fg.GCAL||e===s.Fg.GMAIL?"pumpernickel_enabled":"cinnabon_enabled",{value:t}=(0,l.FL)(n);return t},T=e=>{let n=(0,r.Cf)(),{data:t}=p(),i=!!(Array.isArray(t)&&t.find(n=>n.type===e&&n.enabled));return!n||i},L=e=>{let n=(0,r.rW)(),t=T(e);return!!(F(e)&&t&&n)},P=e=>"sfdc"===e?"salesforce":e,U=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:t}=(0,r.t)(),i=null==t?void 0:t.uuid,a=(0,g.useRouter)(),o=(0,g.usePathname)(),c=(0,g.useSearchParams)(),{callerIdentifier:l,handleAuthSuccess:s}=n,y=L(e),p=(0,f.useQueryClient)(),_=(0,d.Q)(),{data:m,isFetched:h}=(0,u.WE)("/api/organizations/".concat(i,"/sync/").concat(P(e),"/auth"),{queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:i}],enabled:!!(t&&y)}),S=(0,v.useRef)(!1),{mutate:A}=(0,u.uC)("/api/organizations/".concat(i,"/sync/").concat(P(e),"/auth/start"),"POST",{enabled:!!(t&&y),onSuccess:e=>{a.push(e.redirect_url)}});b({callerIdentifier:l,successParam:"".concat(e,"_success"),handleOpen:()=>null==s?void 0:s(!0)});let{mutate:C}=(0,u.uC)("/api/organizations/".concat(i,"/sync/").concat(P(e),"/auth"),"DELETE",{enabled:!!(t&&y),onSuccess:()=>{p.invalidateQueries({queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:i}]})}});return{isAuthenticated:y&&!!(null==m?void 0:m.is_authenticated),startAuth:()=>{if(!S.current&&y){let n=E({pathname:o,searchParams:c,queryString:"".concat(e,"_success=").concat(l),isClaudeApp:_});if(_){window.open("/settings/profile?open_in_browser=1&auth_start=".concat(e,"&origin=").concat(n));return}S.current=!0,A({pre_auth_state:{origin:n},redirect_uri:new URL("/connect/".concat(P(e),"/callback"),window.location.origin).toString()})}},disconnect:C,isFetched:h}},q=(e,n)=>{var t,i;let u=L(e),{account:a}=(0,r.t)(),o=I[e];return o?u&&(n?!!(null==n?void 0:null===(t=n.conversationSettings)||void 0===t?void 0:t[o]):!!(null==a?void 0:null===(i=a.settings)||void 0===i?void 0:i[o])):u},Q=()=>{let{account:e}=(0,r.t)(),{mutate:n}=(0,i.Ck)();return{toggleIntegrationEnabled:(t,i)=>{if(!e)return;let u=I[t];u&&n({...e.settings,[u]:i})}}}},21878:function(e,n,t){t.d(n,{K:function(){return a}});var i=t(19170),u=t(27218),r=t(7653);function a(){let{mutate:e,isPending:n}=(0,i.Ck)(),{account:t}=(0,u.t)();return{dismiss:(0,r.useCallback)(n=>{var i;t&&e({...t.settings,dismissed_claudeai_banners:[...(null==t?void 0:null===(i=t.settings)||void 0===i?void 0:i.dismissed_claudeai_banners)||[],{banner_id:n,dismissed_at:new Date().toISOString()}]})},[t,e]),isDismissed:(0,r.useCallback)(e=>{var n,i;return(null==t?void 0:null===(i=t.settings)||void 0===i?void 0:null===(n=i.dismissed_claudeai_banners)||void 0===n?void 0:n.some(n=>n.banner_id===e))||!1},[t]),isPending:n}}},51879:function(e,n,t){t.d(n,{J:function(){return l},Q:function(){return c}});var i=t(27573),u=t(35919),r=t.n(u),a=t(7653);let o=(0,a.createContext)({isOpen:!1,dropdownToOpen:void 0,openModal:r(),closeModal:r(),clearCallerIdentifier:r()}),c=e=>{let{children:n}=e,[t,u]=(0,a.useState)(!1),r=(0,a.useRef)(void 0),[c,l]=(0,a.useState)(void 0);return(0,i.jsx)(o.Provider,{value:{isOpen:t,openModal:e=>{u(!0),r.current=e},closeModal:()=>{u(!1),l(r.current)},dropdownToOpen:c,clearCallerIdentifier:()=>{l(void 0)}},children:n})},l=()=>(0,a.useContext)(o)},22534:function(e,n,t){t.d(n,{F7:function(){return a},MU:function(){return r},ZZ:function(){return o}});let i="recentDriveDocs";function u(e){return"object"==typeof e&&null!==e&&"string"==typeof e.uri&&("string"==typeof e.title||void 0===e.title)}function r(e){localStorage.setItem(i,JSON.stringify(e))}function a(){let e=localStorage.getItem(i);if(e){let n=JSON.parse(e);if(n&&Array.isArray(n)&&n.every(u))return n}return[]}function o(e){let n=a();r(n=n.filter(n=>n.uri!==e))}},10228:function(e,n,t){var i,u,r,a;t.d(n,{Fg:function(){return i},co:function(){return u},hP:function(){return o},qC:function(){return c}}),(r=i||(i={})).GITHUB="github",r.GDRIVE="gdrive",r.OUTLINE="outlin",r.SALESFORCE="sfdc",r.GMAIL="gmail",r.GCAL="gcal",r.SLACK="slack",r.ASANA="asana";let o={github:"GitHub",gdrive:"Google Drive",outlin:"Outline",sfdc:"Salesforce",gmail:"Gmail",gcal:"Google Calendar",slack:"Slack",asana:"Asana"};(a=u||(u={})).CREATED="created",a.PENDING="pending",a.FAILED="failed",a.UPDATING="updating",a.UPDATE_FAILED="update_failed",a.READY="ready",a.UNAUTHENTICATED="unauthenticated",a.ACCESS_DENIED="access_denied",a.DISABLED="disabled";let c=["access_denied","failed","unauthenticated","update_failed"]}}]);